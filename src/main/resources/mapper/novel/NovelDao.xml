<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="webnovelservice.domain.novel.dao.NovelDao">
  <select id="findByNovelId" resultType="Novel" parameterType="Long">
    SELECT NOVEL_ID
         , TITLE
         , GENRE
         , AUTHOR
         , DESCRIPTION
         , PUBLICATION_DATE
         , PUBLICATION_STATUS
         , CREATED_AT
    FROM NOVEL WHERE NOVEL_ID = #{novelId}
  </select>

  <select id="findByAuthorAndTitle" resultType="Novel" parameterType="NovelRequest">
    SELECT NOVEL_ID
         , TITLE
         , GENRE
         , AUTHOR
         , DESCRIPTION
         , PUBLICATION_DATE
         , PUBLICATION_STATUS
         , CREATED_AT
    FROM NOVEL
    WHERE 1 = 1
        <if test="title != null and title != ''">
            AND TITLE LIKE ('%'+#{title}+'%')
        </if>
        <if test="">
            AND AUTHOR LIKE ('%'+#{author}+'%')
        </if>

  </select>

   <select id="findByMostViews" resultType="Novel" parameterType="NovelRequest">
        SELECT NOVEL_ID
        , TITLE
        , GENRE
        , AUTHOR
        , DESCRIPTION
        , PUBLICATION_DATE
        , PUBLICATION_STATUS
        , CREATED_AT
        FROM NOVEL
   </select>

    <select id="findByMostSales" resultType="Novel" parameterType="NovelRequest">
        SELECT
            NOVEL_ID
             , TITLE
             , GENRE
             , AUTHOR
             , DESCRIPTION
             , PUBLICATION_DATE
             , PUBLICATION_STATUS
             , CREATED_AT
        FROM NOVEL
    </select>

    <insert id="saveNovel" parameterType="Novel" useGeneratedKeys="true" keyProperty="novelId">
    INSERT INTO NOVEL
    (
    TITLE
    , GENRE
    , AUTHOR
    , DESCRIPTION
    , PUBLICATION_DATE
    , PUBLICATION_STATUS
    , CREATED_AT
    ) VALUES
          ( #{title}
          , #{genre}
          , #{author}
          , #{description}
          , #{publicationDate}
          , #{publicationStatus}
          , #{createdAt} )
  </insert>

  <update id="updateNovel" parameterType="Novel">
    UPDATE NOVEL SET
                TITLE = #{title}
              , GENRE = #{genre}
              , AUTHOER = #{author}
              , DESCRIPTION = #{description}
              , PUBLICATION_STATUS = #{publicationStatus}
              , PUBLICATION_DATE = #{publicationDate}
    WHERE NOVEL_ID = #{novelId}
  </update>

  <delete id="deleteNovel" parameterType="Long">
    DELETE FROM NOVEL WHERE NOVEL_ID = #{novelId}
  </delete>
</mapper>
